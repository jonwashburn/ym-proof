name: Yang-Mills Proof CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-verify:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive
        
    - name: Install elan (Lean version manager)
      run: |
        curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh -s -- -y
        echo "$HOME/.elan/bin" >> $GITHUB_PATH
        
    - name: Get Lean dependencies
      run: |
        export PATH="$HOME/.elan/bin:$PATH"
        lake update
      
    - name: Build Yang-Mills proof
      run: |
        export PATH="$HOME/.elan/bin:$PATH"
        echo "üî® Building Yang-Mills proof..."
        lake build
        echo "‚úÖ Build completed successfully!"
        
    - name: Verify axiom-free status
      run: |
        echo "üîç Verifying axiom-free status..."
        bash verify_no_axioms.sh
        echo "‚úÖ Axiom verification passed!"
        
    - name: Verify sorry-free status  
      run: |
        echo "üîç Verifying sorry-free status..."
        bash verify_no_sorries.sh
        echo "‚úÖ Sorry verification passed!"
        
    - name: Generate verification summary
      run: |
        echo "üìä Yang-Mills Proof Verification Summary"
        echo "========================================"
        echo "‚úÖ Build: SUCCESS"
        echo "‚úÖ Axiom-free: VERIFIED"
        echo "‚úÖ Sorry-free: VERIFIED"
        echo ""
        echo "üéØ The proof is complete and formally verified!"
        
    - name: Create build artifacts
      if: success()
      run: |
        echo "BUILD_SUCCESS=true" >> $GITHUB_ENV
        echo "AXIOM_FREE=true" >> $GITHUB_ENV
        echo "SORRY_FREE=true" >> $GITHUB_ENV
        
  verification-status:
    runs-on: ubuntu-latest
    needs: build-and-verify
    if: always()
    
    steps:
    - name: Set verification badges
      run: |
        if [ "${{ needs.build-and-verify.result }}" == "success" ]; then
          echo "üü¢ YANG-MILLS PROOF STATUS: VERIFIED"
          echo "‚úÖ Build: SUCCESS"
          echo "‚úÖ Axiom-free: CONFIRMED" 
          echo "‚úÖ Sorry-free: CONFIRMED"
          echo "üìú Formal verification complete!"
        else
          echo "üî¥ YANG-MILLS PROOF STATUS: FAILED"
          echo "‚ùå Verification failed - check logs"
        fi 